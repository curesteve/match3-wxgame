# 待修复记录

## 1. iOS 真机宝石图片不显示（仅色块）

**现象**
- 微信开发者工具预览：棋盘格能正常显示 `images/gem_0.png`～`gem_4.png` 图片。
- iOS 手机预览：只显示色块棋盘格，不显示图片，且无报错。

**环境**
- 平台：微信小游戏
- 复现设备：iOS 真机
- 相关文件：`game.js` 中 `loadGemImages()`、`drawGemImage()`、`drawBubbleGem()`

**已做过的尝试**
1. 用 `readFile` 读代码包 `images/gem_N.png`，再 `writeFile` 到 `wx.env.USER_DATA_PATH`，用本地路径作 `img.src`（解决开发者工具下 data URL 报错「no supported source」）。
2. 多路径重试：`images/gem_`、`/images/gem_`、`gem_`。
3. readFile 全部失败时回退为 `createImage()` + `img.src = 'images/gem_N.png'`（代码包直连）。
4. 优先使用 `readFileSync` 同步读代码包（避免 iOS 异步 readFile 兼容性问题），成功后再走 writeFile + 本地路径。

**当前逻辑概要（game.js）**
- 微信环境下：先对上述路径做 `readFileSync`；有 base64 则 `applyBase64ToImage`（写 USER_DATA_PATH + img.src = 本地路径）；若同步都失败则走异步 `readFile` 多路径，再失败则 `tryDirectCodePackageLoad`（直连代码包路径）。

**后续可尝试方向**
- 查微信官方文档 / 社区：iOS 真机代码包路径、`readFile`/`readFileSync` 对代码包的支持与路径约定。
- 确认真机包内是否包含 `images/gem_*.png`（上传预览时代码包结构）。
- 考虑用 `wx.getImageInfo({ src: '...' })` 获取可用的本地路径再赋值 `img.src`（需查小游戏侧是否支持代码包路径）。
- 若代码包路径在 iOS 上始终不可用，可考虑将 5 张图放到 CDN，用 `wx.downloadFile` 下载到本地再 `img.src = tempFilePath`。

**记录日期**：2025-02
