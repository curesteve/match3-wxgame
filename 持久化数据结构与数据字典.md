# æŒä¹…åŒ–æ•°æ®ç»“æ„ä¸æ•°æ®å­—å…¸

æœ¬æ–‡æ¡£æè¿°ä¸‰æ¶ˆå°æ¸¸æˆæœ¬åœ°æŒä¹…åŒ–ä½¿ç”¨çš„å­˜å‚¨ Keyã€æ•°æ®ç»“æ„åŠå­—æ®µå«ä¹‰ã€‚æœ¬åœ°å­˜å‚¨ä½¿ç”¨å¾®ä¿¡ APIï¼š`wx.getStorageSync` / `wx.setStorageSync`ã€‚

---

## ä¸€ã€å­˜å‚¨ Key ä¸€è§ˆ

| Key | ç”¨é€” | å®ç°çŠ¶æ€ |
|-----|------|----------|
| `game_save` | æ¸¸æˆä¸»å­˜æ¡£ï¼ˆè¿›åº¦ã€æ˜Ÿçº§ã€æœ€ä½³åˆ†ã€å¯¹å±€è®°å½•ï¼‰ | âœ… å·²å®ç° |
| `game_settings` | è®¾ç½®ï¼ˆéŸ³æ•ˆ/éŸ³ä¹å¼€å…³ç­‰ï¼‰ | ğŸ“‹ è®¡åˆ’ä¸­ï¼Œå½“å‰æœªè¯»å†™ |

---

## äºŒã€`game_save` æ ¹ç»“æ„ï¼ˆSaveDataï¼‰

å­˜æ¡£åœ¨å†…å­˜ä¸­ä¸ºå¯¹è±¡ `saveData`ï¼Œåºåˆ—åŒ–åä»¥ JSON å­—ç¬¦ä¸²å†™å…¥ `wx.setStorageSync('game_save', JSON.stringify(data))`ã€‚

### 2.1 ç±»å‹ä¸é»˜è®¤å€¼

```js
{
  version: 1,
  maxUnlockedLevel: 1,
  stars: {},
  bestScorePerLevel: {},
  gameRecords: [],
  updatedAt: 0
}
```

### 2.2 æ•°æ®å­—å…¸ï¼ˆæ ¹å­—æ®µï¼‰

| å­—æ®µå | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `version` | number | æ˜¯ | 1 | å­˜æ¡£æ ¼å¼ç‰ˆæœ¬ï¼Œä¾¿äºåç»­å…¼å®¹ä¸è¿ç§» |
| `maxUnlockedLevel` | number | æ˜¯ | 1 | å½“å‰å·²è§£é”çš„æœ€å¤§å…³å¡ IDï¼ˆå¯è¿›å…¥çš„æœ€å¤§å…³å¡ï¼‰ |
| `stars` | object | æ˜¯ | `{}` | å„å…³å¡å†å²æœ€ä½³æ˜Ÿçº§ã€‚keyï¼šå…³å¡ IDï¼ˆè½¬ä¸ºå­—ç¬¦ä¸²ï¼‰ï¼›valueï¼š0ï½3 æ˜Ÿ |
| `bestScorePerLevel` | object | æ˜¯ | `{}` | å„å…³å¡å†å²æœ€ä½³åˆ†æ•°ã€‚keyï¼šå…³å¡ IDï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼›valueï¼šåˆ†æ•°ï¼ˆnumberï¼‰ |
| `gameRecords` | array | æ˜¯ | `[]` | å¯¹å±€è®°å½•åˆ—è¡¨ï¼Œæ¯å±€ä¸€æ¡ï¼ˆè¿‡å…³æˆ–å¤±è´¥éƒ½ä¼šè¿½åŠ ï¼‰ï¼Œç”¨äºå›æ”¾/ç»Ÿè®¡/äº‘åŒæ­¥ |
| `updatedAt` | number | æ˜¯ | 0 | å­˜æ¡£æœ€åæ›´æ–°æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œ`Date.now()`ï¼‰ï¼Œç”¨äºäº‘ç«¯åˆå¹¶ä¸å†²çªåˆ¤æ–­ |

### 2.3 è¯»å–ä¸è¡¥å…¨ï¼ˆloadSaveï¼‰

- ä½¿ç”¨ `wx.getStorageSync('game_save')` è¯»å–å­—ç¬¦ä¸²ï¼Œ`JSON.parse` åè‹¥ç¼ºå°‘æŸå­—æ®µæˆ–ç±»å‹ä¸å¯¹ï¼Œä¼šæŒ‰ä¸Šè¡¨è¡¥å…¨ä¸ºé»˜è®¤å€¼ã€‚
- å¼‚å¸¸æˆ–ç©ºæ¡£æ—¶è¿”å› `getDefaultSave()`ï¼Œå³ä¸Šè¿°é»˜è®¤ç»“æ„ã€‚

---

## ä¸‰ã€`gameRecords` å•æ¡è®°å½•ç»“æ„ï¼ˆGameRecordï¼‰

æ¯å±€ç»“æŸï¼ˆè¿‡å…³æˆ–å¤±è´¥ï¼‰ä¼šå‘ `saveData.gameRecords` è¿½åŠ ä¸€æ¡è®°å½•ï¼Œå¹¶å¯èƒ½åŒæ­¥åˆ°äº‘ç«¯ `dataService.submitRecord`ã€‚

### 3.1 ç±»å‹ï¼ˆè¿‡å…³ / å¤±è´¥å…±ç”¨åŒä¸€ç»“æ„ï¼‰

```js
{
  levelId: number,
  durationSec: number,
  movesUsed: number,
  totalMoves: number,
  score: number,
  stars: number,
  elim3: number,
  elim4: number,
  elim5: number,
  elim6Plus: number,
  win: boolean,
  timestamp: number
}
```

### 3.2 æ•°æ®å­—å…¸ï¼ˆå•æ¡è®°å½•å­—æ®µï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `levelId` | number | æœ¬å±€å…³å¡ ID |
| `durationSec` | number | æœ¬å±€æ¸¸æˆæ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œä¿ç•™ä¸¤ä½å°æ•° |
| `movesUsed` | number | æœ¬å±€å·²ç”¨æ­¥æ•°ï¼ˆtotalMoves - movesLeftï¼‰ |
| `totalMoves` | number | æœ¬å±€æ€»æ­¥æ•°ï¼ˆå…³å¡é…ç½®çš„æ­¥æ•°ï¼‰ |
| `score` | number | æœ¬å±€å¾—åˆ† |
| `stars` | number | æœ¬å±€è·å¾—æ˜Ÿçº§ï¼ˆè¿‡å…³ 1ï½3ï¼Œå¤±è´¥ä¸º 0ï¼‰ |
| `elim3` | number | æœ¬å±€ 3 è¿æ¶ˆé™¤æ¬¡æ•° |
| `elim4` | number | æœ¬å±€ 4 è¿æ¶ˆé™¤æ¬¡æ•° |
| `elim5` | number | æœ¬å±€ 5 è¿æ¶ˆé™¤æ¬¡æ•° |
| `elim6Plus` | number | æœ¬å±€ 6 è¿åŠä»¥ä¸Šæ¶ˆé™¤æ¬¡æ•° |
| `win` | boolean | æ˜¯å¦è¿‡å…³ï¼štrue=è¿‡å…³ï¼Œfalse=å¤±è´¥ |
| `timestamp` | number | è®°å½•ç”Ÿæˆæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œ`Date.now()`ï¼‰ |

---

## å››ã€äº‘ç«¯åŒæ­¥ä½¿ç”¨çš„æ•°æ®å­é›†

ç™»å½•åï¼Œä»¥ä¸‹å­—æ®µä¼šä¸å¾®ä¿¡äº‘å¼€å‘åŒæ­¥ï¼ˆ`dataService.saveProgress` / `dataService.getProgress`ï¼‰ï¼Œç»“æ„ä¿æŒä¸€è‡´ï¼š

- `maxUnlockedLevel`
- `stars`
- `bestScorePerLevel`
- `updatedAt`

å•æ¡å¯¹å±€è®°å½•ä¼šé€šè¿‡ `dataService.submitRecord(userId, recordWin | recordFail)` æäº¤ï¼Œç»“æ„å³ä¸ŠèŠ‚çš„ GameRecordã€‚

---

## äº”ã€ç›¸å…³ä»£ç ä½ç½®ï¼ˆgame.jsï¼‰

| åŠŸèƒ½ | ä½ç½®ï¼ˆçº¦ï¼‰ |
|------|------------|
| å­˜å‚¨ Keyã€é»˜è®¤å­˜æ¡£ã€loadSave/saveSave | çº¦ 121ï½145 è¡Œ |
| è¿‡å…³æ—¶å†™ stars / bestScorePerLevel / gameRecords / updatedAtã€saveSaveã€äº‘åŒæ­¥ | çº¦ 1145ï½1179 è¡Œ |
| å¤±è´¥æ—¶å†™ gameRecords / updatedAtã€saveSaveã€äº‘åŒæ­¥ | çº¦ 1184ï½1213 è¡Œ |
| å¯åŠ¨æ—¶ loadSave èµ‹ç»™ saveDataã€äº‘ç«¯æ‹‰å–åˆå¹¶ | çº¦ 2307ã€2317ï½2325 è¡Œ |

---

## å…­ã€ç®€è¦ç»“æ„ç¤ºæ„

```
game_save (wx Storage Key)
â””â”€â”€ SaveData (JSON å¯¹è±¡)
    â”œâ”€â”€ version: number
    â”œâ”€â”€ maxUnlockedLevel: number
    â”œâ”€â”€ stars: { [levelId: string]: number }        // 0..3
    â”œâ”€â”€ bestScorePerLevel: { [levelId: string]: number }
    â”œâ”€â”€ gameRecords: GameRecord[]
    â”‚   â””â”€â”€ GameRecord: { levelId, durationSec, movesUsed, totalMoves, score, stars, elim3, elim4, elim5, elim6Plus, win, timestamp }
    â””â”€â”€ updatedAt: number
```

ä»¥ä¸Šå³ä¸ºå½“å‰æŒä¹…åŒ–æ•°æ®çš„**æ•°æ®ç»“æ„**ä¸**æ•°æ®å­—å…¸**ï¼Œå¯ç›´æ¥ç”¨äºå¯¹æ¥äº‘ç«¯ã€åšå­˜æ¡£è¿ç§»æˆ–é…ç½®å·¥å…·ã€‚
